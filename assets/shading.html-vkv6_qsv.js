import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as p,o as t}from"./app-Bm4QM-xh.js";const o="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASsAAAGGCAMAAAAU+Fe2AAAARVBMVEUAAACUeVyRd1pgTjsWEQ0dFxINCwhpVkFZSTd9Zk2GblMlHhdCNigsIxpKPC47MCRQQTGMcld2YUk0KiBwXEZTRDOBaVANsoCMAAAKDklEQVR42uzd23abMBCF4ZmNQBwsYw7h/R+12I1XXMcQ2oSyBfP1srn61xhzELIYY4wxxhhjjDHGGGOM2chlVIv5Wp5jNFisL70l0BuL9ZW3BqoWa5FWVS3WInmjD4ZOzJQc+ggnMdOprNVCiT6BHbEm5PqJtZqQWKulLjhyq9TJclly2FZpVQUUVVUt7XVWPWarKpQAVAH44KzVjGrQB8mSWC45ZqtQQB9gSawTjtnK65PEWavXukLvFk9W6vWIrcZUnwWZV+shW+X6gncyJ+316nDXgy9bYT5WB30BiZN9y/UVpEtaHe2eTK4vtU4mpYUestWp1Jcw0yroMVu9QV8bMmu1tBUmW6WltXoy2aqCvnSWnZtuBZkQjtrq3Ey2cpI9kLsUetBWkusUpLhToHZXIhKs1Vdwk6YB1mqhayhrtdCRW9WDtVossVaLJbBWhK3cOUjUQrFmq+7ywGt7uYr3nqDXn9E+DU2ajwo8uJ+m+fE/MolPnZT6DRP3GZJRr3PGP8glLvUA/SlF+N3Je4+RzsIoqlhdP+gPKvqr5fEjihXaAfqjcKXLNbHEqkrdXCSTxZAqklgplAESoUeSKoZWjiRVBK1YpiqCVjyp6FtVPKnYW3GcLETRKjCl4m4VBmWCthJWHVcq1YL3bVavXIg/g3RjRdwqITpduKE9XHUJ21ipF07dwDZVWqTCKPR0Q6XohVHgGyrVgvFJYVpQna3ftUKI6XL5w0D5QJWyFQphxNgKg1AibIVGOPG1QkF5YGdsBdZSfK3QUn4F3py4WqFnPAmle3BzBc+bSs5KhTkVzVNm/lRUreDPnPdh3uVErTx1Kcl4UoE8FU8r9B15KprnXOjZS4mQjFVR8afiaIWB+UyBqRUaF0UqgjvtAO+lMtlYIYqZGjXbt2oimSpp9K8ddawIrgXj+AbkOLJHcFp1k27fCrG0Krb/CMbTSrcXyR5i3fYfwWi+B1slYK321urE8BGM491T6bf/FryK4cqZY6ziaMVy81it1XKcy40fXba/xfAOwo7nhRLSlaEPEqXBPlhvNGPF3ypXHrQLaX+7EI2VKnWrjGlxDPc1IVkq1VJokS2mZW7lmA7s5K1qZUPbyhGdhr5rSPdhIEylSnqZE9gO7LytKMeKtBXbi0rErZy3VgtlJA8kYmhFsIgollYZwwqGSFqxpmK8jUz6CdSS77kXwUraWK4HaVPxtaJ5oyuCViTrF2LYj8HxtqJ7NkGwkHYC2Pblo9romPxZKsWCxzhake10TL0KkvT+AuNY0W3fS9yKZhEf/8841sxjRXbdzLOIj/5H/VmWZ8ewRoZu/cKDWrgQt6J7f9Ba7aEV6H6nmLgV3a8k8LaiGyuuRcd/oFt3RdwKnRsRbVPE9I7EM9yU6bvNr3eYW91h/KeKvLqR5Y7zGXyG37oQgmyiY13GMKfpuq6SRQ5yzjA/Ym1dpzLPWn3oT/O1rNWGWyQH4gdeC/iLk3kHuS9Kt/195K1UfSYTrNUzeC//ies1duhlxlGeD7It0nJxfxP+31icr5aQxtrBYH1xzDrEQhm+WO0uYnmZt/t1yH8Bk2eldnj/BImTzyyWxYokFuV74bSxdjJZ9UhWlu1jsm4up9PpZbDdbuf0DQCa8/ncyZMdb1L0XcPb5RJkFa7ex0Hrz6djeSWrcHuLddUm63w7upBgd7mA3q9Tq9rHeemT1suH3W8s801oe1lB5njfVOW7eZpl5Q5rofSyDuzvIL/eDcGMd4eLfwYkso60LHfXa4y1llAUu7jD/AG5k9Wc2lGzn8MXcMlkTW++7+Nf+nA3xlqb/9XevS23CQRRFO05DBcjBAIJ//+nRrEfrBvQCBA9cHaq8p5VKJaB6U7TCxSZR4UCa3o+Gi6zOvvvptPqZwvCuccKM1ix/QvLncRGIVihFROFYOWcDawkiIM+Rkb72JxDbRMrDCsbI+4CsbIw486HctbOAFYYPwdtYMUumBpZN29mM6b9Cyucj+DqWIbHK79qnNWeL6sJx+q2PDff4Nd3k+ubeku9aNv5ZeUcTrJO5wCt0lhGtf19DOamvprbIqpq5IW163NQKGQ4Wv12iUXdDqdE3YVKxrTpXVcWLyzDY7v7w1k+XLjnVPRWPJPvvg/SG63emP7K4616K456cK6OpSdarTetOjH/Qp8dq7DnQ+Es3dFKv4mAVrQKwSoO+Zuo3orjMGhFq99opS9kK8tbH61ZBT9ihVa0ukYrfQFbWV6RqWzAik9Rb8q9DLWfHU5WNrTSag+PUT9uVbrwoxWtrtFKX6hW3v5IBjNWYb5SSytaPUcrfbTSRyt9gVodg31X+/PHeSu3iZDIU7SiFa06o9X4ghpcFOC53ddBHqMVrWg1UGiPnjdj9Xxh0YpWIVj5DTxH/ZTV0W0mFHIXrbpDLXfRqida0eoarcYV1A/CTVmlchut+splyeLQD5cMWu1uADmtaKWPVvpoNbJwDk9sywpf8hetaDVXtKLVNVrpC8oq2c6TiU6rva6XoBWtFNFKH6300UofrfTRSt/OrAAY8rZrhboQkbS+5mYOwLas2sVWoCCVM7ZkhVb+wsxUG7PKi4WskMrWrDJZxuqSyrXDF63UL3BUtBoKQqvxVqCV1iq+0EprJQU2Y9Uc5aaSVt0hWmaJdkErbUho9YaVj2iltZLS1LsfG7PKvdy0dSsc5cbK1Ht99qy8WSs5glbaDqatYOrskjWr3MtNLWjVXSx2reIvU1Z4tNrGGd5FrBr/YGXpSJwtKxzkrurb0lFL21aS2bKCe6/van6r1Ju28incW6Uyv9VRJlihldetP09mAavIP88+NXRZWbLCedKuv1Ies2olBaZfVq+sLM2B9Nk8Vn6yVSWvrKwM3vmpggUrREf/cj+wqdnR750zaeJZrRD5SXunUYmidWaS4yIKq+lU4hsrgw1/a9e2QppIVylM7e4vsa4VUukuaXS/HClaaU8c0hmtLtJXA80TDUVr7Wps5KnYvRkuMoBl5hP4v2yGT02MpUYxfcH1VSuoVrT6khmtGpEpWHklH62s3ZiwtJX+Y5g3I6jW2EePSPFNSBsyGe6ieG/8UxX59GeWByx3hiZJ8YpZRbUqFrIZrdCKCit61qojHdWaWHXXLdZF5zD5LMVtWVbKWhW104XTjM85UIq6+NT+/Ll2/UvWrKgn/uuOsDc/dakKTLtX66P9WGlu+6FQ3o+2dd9pgc6YQiVnWBvLu2THCv1UifSUtO4uUzcIFqjChAcA1Y4uq//FBV5xAShjGSgZeXfnIKHnS+DRC5n3oqg1t9tt6ZJrEW6KEtFVwtSmJNu1INXsWHX4/1l96l5YHfbXhZlqawVVTiolVt6chamwvsP9LXD+2hRwXeUpqe7KImfocYL1sghw9wHIM1K96tRG91pte6JUV778qYnKn4QNdvDCGGOMMcYYYw/9AxzhD0ni/trZAAAAAElFTkSuQmCC",e="/assets/20210301114132-D-SRm6LS.png",l="/assets/20210301172638-CVY-5V2I.png",c="/assets/20210301174026-B2ii9SAc.png",i="/assets/20210301174507-CfnE70D9.png",r="/assets/20210301182131-DF9Qv5J8.png",u="/assets/20210301182634-qg9_91dI.png",d="/assets/20210303111736-DmFUyLqo.png",k="/assets/20210302101407-DY5_MSJZ.png",h="/assets/20210302145902-NgCYnAl0.png",g="/assets/20210302144921-CSnBsjQ8.png",m="/assets/20210302145345-B6wYWYJQ.png",b="/assets/20210303111602-BZxrloTh.png",v="/assets/20210303112928-Cd6qGktL.png",f="/assets/20210303113823-C62-QHxa.png",V="/assets/20210303183448-BgBCCeA4.png",W="/assets/20210303183019-iP19LXCV.png",_="/assets/20210303182814-CjFo_Mfw.png",K="/assets/20210303183314-FnIj4kUF.png",w={};function q(x,n){return t(),a("div",null,n[0]||(n[0]=[p('<h1 id="着色" tabindex="-1"><a class="header-anchor" href="#着色"><span>着色</span></a></h1><p>我们在前面已经把图像三角形化了，明白了三角形的绘制规则，这样我们可以把一个物体画出来了，如下图：</p><img src="'+o+'" width="60%"><p>我们看到这个图是感受不出来是一个3d的模型，就是看起来很不真实，我们可以认出这个是个牛的模型，但是不知道这个是什么牛。</p><p>我们现实世界中看一个物体认为他是三维物体，是因为光照的关系，让物体表面有了明暗的差别，让我们知道是什么牛是因为物体表面的质感，也就是材质。</p><p>如果我们要在电脑上实现明暗的差别，简单的说就是为我们的渲染世界加一个灯，然后我们根据灯的一些属性（位置，方向，强度，颜色等）接合我们模型的颜色和位置，就可以产生明暗差别的效果（高光，漫反射，环境光）。如下图：</p><img src="'+e+'" width="%"><p>计算明暗差别这个过程一般叫做<strong>着色</strong>，换句话说，着色是根据材质属性（如漫反射属性等）、光源信息（如光源方向、辐照度等），使用一个等式去计算沿某个观察方向的出射度的过程。我们也把这个等式称为光照模型。</p><h2 id="标准光照模型" tabindex="-1"><a class="header-anchor" href="#标准光照模型"><span>标准光照模型</span></a></h2><p>标准光照模型也就是Binn-Phong着色模型，主要由四部分组成：</p><ul><li>漫反射（Diffuse）：当光线从光源照射到模型表面时，该表面会向每个方向散射多少辐射量</li><li>高光（Specular）：描述当光线从光源照射到模型表面时，该表面会在完全镜面反射方向散射多少辐射量</li><li>环境光（Ambient）：描述其他所有的间接光照</li><li>自发光（Emissive）：当给定一个方向时，一个表面本身回想该方向发射多少辐射量。需要注意的是，如果没有使用全局光照技术，这些自发光的表面并不会真的照亮周围的物体，而是它本身看起来更亮了而已。这个一般物体是没有的。</li></ul><p>对于每个着色点，我们可以简化成如下图所示：</p><img src="'+l+'" width="%"><p>其中有：</p><ul><li>$n$ ：表面法线方向</li><li>$l$ ：入射光方向</li><li>$v$ ：观察方向</li></ul><p><strong>注意：所有向量都是单位向量，所以确保向量进行过 normalize 操作。</strong></p><p>另外，着色过程中是不会产生阴影的，阴影是通过其他技术手段来生成的。</p><h2 id="漫反射" tabindex="-1"><a class="header-anchor" href="#漫反射"><span>漫反射</span></a></h2><p>漫反射光照是用于对那些被物体表面随机散射到各个方向的辐射度进行建模。</p><img src="'+c+'" width="%"><p>在漫反射中，视角的位置不重要，因为反射是完全随机的，因此可以认为在任何反射方向上的分布都是一样的。所以物体表面的颜色都是一样在任何方向上。</p><p>但是我们看到上面的牛的图片中并不是每个地方的颜色都一样，这里就会说到<strong>兰伯特定律（Lambert&#39;s law）</strong>：反射光线的强度与表面法线和光源方向之间夹角的余弦值成正比。因此入射光线的角度就很重要了。</p><p>可以这样理解这个过程，平时看一个物体的颜色，会受到物体本身表面的颜色和照射到该物体上的光的影响。比如：一个白色盒子在绿色灯光上，这个盒子我们看到就会是绿色，当然这个盒子上的绿色会根据我们灯光的强度和方向来改变成浅绿色或者深绿色。</p><h3 id="光的方向" tabindex="-1"><a class="header-anchor" href="#光的方向"><span>光的方向</span></a></h3><p>我们知道一个红色的物体为什么是红色？是因为这个物体吸收了我们可以从光打到表面上，表面吸收了多少能量来理解这个：</p><img src="'+i+'" width="%"><p>这里我们可以看上图：</p><ul><li>左：光线与平面法线平行，平面接受了所有光线的能量（6根光线）</li><li>中：光线与平面法线夹角为 60度，平面只接受了一半光线的能量（3根光线）</li><li>右：平面能接受的能量与该平面的法线和入射光的角度有关。其关系是：平面接受的能量的百分比 = <strong>cos(n,l) = n·l</strong></li></ul><h3 id="光的强度" tabindex="-1"><a class="header-anchor" href="#光的强度"><span>光的强度</span></a></h3><p>我们明白了光照射到平面的方向的关系了，光的强度我们可以用烤火来理解，我们离火堆很近温度就高一些，离火堆远一点，温度就小一点，那我们就可以以火堆为圆心，火堆到我们的距离为半径，模拟成下图：</p><img src="'+r+'" width="60%"><h3 id="兰伯特光照模型" tabindex="-1"><a class="header-anchor" href="#兰伯特光照模型"><span>兰伯特光照模型</span></a></h3><p>接合上面两个因素我们就可以得到一个公式：</p><img src="'+u+'" width="%"><p>这其中：</p><ul><li>$L_d$：着色点的漫反射分量</li><li>$K_d$：漫反射系数，可调节。一般使用该着色点的RGB颜色。</li><li>$(I/r^2)$：光照强度</li><li>$max(0,n \\cdot l)$:如果光照方向与表面发现反方向，是不会接收到光照的，反方向点乘为负数，所以限制为0。</li></ul><p>Kd数值对漫反射数值的影响：</p><img src="'+d+'" width="%"><h2 id="高光反射" tabindex="-1"><a class="header-anchor" href="#高光反射"><span>高光反射</span></a></h2><p>我们平时看一些金属或者光滑的表面，我们会发现一些亮白色的块，那个就是高光。我们也可以容易的发现，当我们的眼睛移动时，物体表面的亮白色块也会移动。所以观察方向会影响到高光，相对漫反射中的条件就会多一个视角方向。这个亮块就是我们光源的反射造成的，它的颜色通常是光源的颜色。</p><h3 id="phong" tabindex="-1"><a class="header-anchor" href="#phong"><span>Phong</span></a></h3><p>我们要模拟高光现象，用到了<strong>Phong光照模型</strong>，我们先看高光反射示意图：</p><img src="'+k+'" width="60%"><p>图中所示：</p><ul><li>$l$：光源</li><li>$n$：法线</li><li>$r$：光源放射</li><li>$v$：观察</li></ul><p>我们可以认为σ角越小时，就会看到高光。这个好比我们直接眼睛看光源，我们正对看光源，就会被闪瞎。我们就可以得到简单的公式：<strong>c = l(v·r)</strong>。</p><p>这个公式有两个问题：</p><ul><li>点乘的结果会是负数</li><li>这样造成的亮块会比真实的亮块宽一些</li></ul><p>为了解决这个问题我们可以把公式写成 ：<strong>c = lmax(0,v·r)^p</strong>。</p><img src="'+h+'" width="80%"><p>上图可以看出为什么我们使用指数可以把亮块变窄，也就是数值就变窄。</p><img src="'+g+'" width="40%"><p><strong>r</strong> 向量我们可以使用上图解释列出公式：<strong>r = −l + 2(l · n)n</strong></p><p>然后写出最终公式：</p><p>$$L_s = k_s \\cdot (\\frac I {r^2}) \\cdot max(0, v \\cdot r)^p$$</p><p>$$\\qquad\\qquad\\qquad\\quad= k_s \\cdot (\\frac I {r^2}) \\cdot max(0, v \\cdot (-l + 2( l \\cdot n)n))^p$$</p><h3 id="blinn" tabindex="-1"><a class="header-anchor" href="#blinn"><span>Blinn</span></a></h3><p>上述就是Phong光照模型，Blinn提出了一个简单的修改方法来得到类似的效果。它的基本思想是，避免计算反射方向 <strong>r</strong>。为此，Blinn模型引入了一个新的矢量 <strong>h</strong>，他是通过 <strong>l</strong> 和 <strong>v</strong> 的取平均后再归一化得到，也就是光源方向与视角方向的中间。根据我们漫反射公式，我们就可以写出最终公式：</p><img src="'+m+'" width="%"><p>公式中：</p><ul><li>$L_s$：高光反射</li><li>$K_s$：高光反射系数</li><li>$p$：用来调节高光的可是范围</li></ul><p>Ks与p系数变化对高光的影响：</p><img src="'+b+'" width="%"><p>在硬件实现时，如果摄像机和光源距离模型足够远的话，Blinn模型会快于Phong模型，这是因为，此时可以认为 <strong>v</strong> 和 <strong>l</strong> 都是定值，因此 <strong>h</strong> 将是一个常量。但是，当 <strong>v</strong> 或者 <strong>l</strong> 不是定值时，Phong模型可能反而更快一些。需要注意的是，这两种光照模型都是经验模型，也就是说，我们不应该认为Blinn模型是对“正确的”Phong模型的近似。实际上，在一些情况下，Blinn模型更符合实验结果。</p><h2 id="环境光" tabindex="-1"><a class="header-anchor" href="#环境光"><span>环境光</span></a></h2><p>虽然标准光照模型的重点在于描述直接光照，但在现实的世界中，物体也可以被<strong>间接光照</strong>所照亮。间接光照指的是，光线通常会在多个物体之间反射，最后进入摄像机，也就是说，在管线进入摄像机之前，经过了不止一次的物体反射。例如，在红地毯上放置一个浅灰色的沙发，那么沙发底部也会有红色，这些红色是由红地毯反射了一部分光线，再反弹到沙发上的。</p><p>在标准光照模型中，我们使用了一种被称为环境光的部分来近似模拟间接光照。环境光的计算非常简单，它通常是个全局变量，即场景中的所有物体都使用这个环境光。下面给出计算环境光的部分：</p><img src="'+v+'" width="%"><p>这其中：</p><ul><li>$L_a$：着色点的环境光分量</li><li>$K_a$：材质的环境系数</li><li>$I_a$：场景的环境光强度</li></ul><p>值得注意这个公式也是近似的算法。</p><h2 id="blinn-phong-展示" tabindex="-1"><a class="header-anchor" href="#blinn-phong-展示"><span>Blinn Phong 展示</span></a></h2><p>当我们计算出漫反射、高光、环境光之后，把它们加起来，就能得到 Blinn Phong 着色模型的结果了：</p><img src="'+f+'" width="%"><p>Blinn Phong的着色公式为：$L = L_a + L_d + L_s$</p><p>$$L = k_a I_a + k_d(\\frac {I} {r^2}) max(0, n \\cdot l) + k_s(\\frac {I} {r^2}) max(0, n \\cdot h)^p$$</p><h2 id="逐像素还是逐顶点" tabindex="-1"><a class="header-anchor" href="#逐像素还是逐顶点"><span>逐像素还是逐顶点</span></a></h2><p>上面，我们给出了基本光照模型使用的数学公式，那么我们在哪里计算这些光照模型呢？通常来讲，我们有两个选择：在片元着色器中计算，也被称为<strong>逐像素光照</strong>；在顶点着色器中计算，也被称为<strong>逐顶点光照</strong>。</p><h3 id="平面着色" tabindex="-1"><a class="header-anchor" href="#平面着色"><span>平面着色</span></a></h3><p>平面着色是指整个三角面中共用一个方向的法线，因此表现为整个三角面的颜色都是一样的。如下图：</p><figure><img src="'+V+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="phong着色" tabindex="-1"><a class="header-anchor" href="#phong着色"><span>Phong着色</span></a></h3><p>在逐像素光照中，我们会以每个像素为基础，得到它的法线（可以是对顶点法线插值得到的，也可以是从法线纹理中采样得到的），然后进行光照模型的计算。这种在面片之间对顶点法线进行插值的技术被称为<strong>Phong着色</strong>，也被称为Phong插值或法线插值着色技术。这不同于我们之前讲到的Phong光照模型。 Phong着色如下图：</p><figure><img src="'+W+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="高洛德着色" tabindex="-1"><a class="header-anchor" href="#高洛德着色"><span>高洛德着色</span></a></h3><p>与之相对的是逐顶点光照，也被称为<strong>高洛德着色</strong>。在逐顶点光照中，我们在每个顶点上计算光照，然后会在渲染图元内部进行线性插值，最后输出成像素颜色。**由于顶点数目往往小于像素数目，因此逐顶点光照的计算量往往要小于逐像素光照。**高洛德着色如下图：</p><figure><img src="'+_+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>但是，由于逐顶点光照依赖于线性插值来得到像素光照，因此，当光照模型中有非线性的计算（例如计算高光反射）时，逐顶点光照会在渲染图元内部对顶点颜色进行插值，这回导致渲染图元内部的颜色总是暗于顶点处的最高颜色，这在某些情况下会<strong>产生明显的棱角</strong>。</p><h3 id="对比" tabindex="-1"><a class="header-anchor" href="#对比"><span>对比</span></a></h3><figure><img src="'+K+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>如图所示，着色频率对结果的影响，取决于模型的复杂度。模型的复杂度越低，着色结果区别越大，但随着模型复杂度的提高，平面着色也可以达到冯氏着色的效果。<strong>因此我们不能迷信冯氏着色一定比平面着色好。</strong></p><h2 id="简单实现" tabindex="-1"><a class="header-anchor" href="#简单实现"><span>简单实现</span></a></h2><div class="language-cpp line-numbers-mode" data-highlighter="prismjs" data-ext="cpp" data-title="cpp"><pre><code><span class="line">Vector3f <span class="token function">phong_fragment_shader</span><span class="token punctuation">(</span><span class="token keyword">const</span> fragment_shader_payload <span class="token operator">&amp;</span>payload<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">{</span></span>
<span class="line">    Vector3f ka <span class="token operator">=</span> <span class="token function">Vector3f</span><span class="token punctuation">(</span><span class="token number">0.005</span><span class="token punctuation">,</span> <span class="token number">0.005</span><span class="token punctuation">,</span> <span class="token number">0.005</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    Vector3f kd <span class="token operator">=</span> payload<span class="token punctuation">.</span>color<span class="token punctuation">;</span></span>
<span class="line">    Vector3f ks <span class="token operator">=</span> <span class="token function">Vector3f</span><span class="token punctuation">(</span><span class="token number">0.7937</span><span class="token punctuation">,</span> <span class="token number">0.7937</span><span class="token punctuation">,</span> <span class="token number">0.7937</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">auto</span> l1 <span class="token operator">=</span> light<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">auto</span> l2 <span class="token operator">=</span> light<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>light<span class="token operator">&gt;</span> lights <span class="token operator">=</span> <span class="token punctuation">{</span>l1<span class="token punctuation">,</span> l2<span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    Vector3f amb_light_intensity<span class="token punctuation">{</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    Vector3f eye_pos<span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">float</span> p <span class="token operator">=</span> <span class="token number">150</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    Vector3f color <span class="token operator">=</span> payload<span class="token punctuation">.</span>color<span class="token punctuation">;</span></span>
<span class="line">    Vector3f point <span class="token operator">=</span> payload<span class="token punctuation">.</span>view_pos<span class="token punctuation">;</span></span>
<span class="line">    Vector3f normal <span class="token operator">=</span> payload<span class="token punctuation">.</span>normal<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    Vector3f result_color <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> <span class="token operator">&amp;</span>light <span class="token operator">:</span> lights<span class="token punctuation">)</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// For each light source in the code, calculate what the *ambient*, *diffuse*, and *specular*</span></span>
<span class="line">        <span class="token comment">// components are. Then, accumulate that result on the *result_color* object.</span></span>
<span class="line">        Vector3f l <span class="token operator">=</span> <span class="token punctuation">(</span>light<span class="token punctuation">.</span>position <span class="token operator">-</span> point<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">normalized</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        Vector3f I_r2 <span class="token operator">=</span> <span class="token punctuation">(</span>light<span class="token punctuation">.</span>intensity <span class="token operator">/</span> <span class="token punctuation">(</span>light<span class="token punctuation">.</span>position <span class="token operator">-</span> point<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">squaredNorm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">normalized</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        Vector3f v <span class="token operator">=</span> <span class="token punctuation">(</span>eye_pos <span class="token operator">-</span> point<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">normalized</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        Vector3f h <span class="token operator">=</span> <span class="token punctuation">(</span>v <span class="token operator">+</span> l<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">normalized</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        Vector3f n <span class="token operator">=</span> normal<span class="token punctuation">.</span><span class="token function">normalized</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        Vector3f ambient <span class="token operator">=</span> ka<span class="token punctuation">.</span><span class="token function">cwiseProduct</span><span class="token punctuation">(</span>amb_light_intensity<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        Vector3f diffuse <span class="token operator">=</span> kd<span class="token punctuation">.</span><span class="token function">cwiseProduct</span><span class="token punctuation">(</span>I_r2<span class="token punctuation">)</span> <span class="token operator">*</span> std<span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0.f</span><span class="token punctuation">,</span> n<span class="token punctuation">.</span><span class="token function">dot</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        Vector3f specular <span class="token operator">=</span> ks<span class="token punctuation">.</span><span class="token function">cwiseProduct</span><span class="token punctuation">(</span>I_r2<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token function">pow</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0.f</span><span class="token punctuation">,</span> n<span class="token punctuation">.</span><span class="token function">dot</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        result_color <span class="token operator">+=</span> ambient <span class="token operator">+</span> specular <span class="token operator">+</span> diffuse<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">return</span> result_color <span class="token operator">*</span> <span class="token number">255.f</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,93)]))}const U=s(w,[["render",q],["__file","shading.html.vue"]]),P=JSON.parse('{"path":"/Graphic/basic/raster/shading.html","title":"着色","lang":"en-US","frontmatter":{"date":"2021-03-01T18:53:55.000Z","tag":["Graphic"]},"headers":[{"level":2,"title":"标准光照模型","slug":"标准光照模型","link":"#标准光照模型","children":[]},{"level":2,"title":"漫反射","slug":"漫反射","link":"#漫反射","children":[{"level":3,"title":"光的方向","slug":"光的方向","link":"#光的方向","children":[]},{"level":3,"title":"光的强度","slug":"光的强度","link":"#光的强度","children":[]},{"level":3,"title":"兰伯特光照模型","slug":"兰伯特光照模型","link":"#兰伯特光照模型","children":[]}]},{"level":2,"title":"高光反射","slug":"高光反射","link":"#高光反射","children":[{"level":3,"title":"Phong","slug":"phong","link":"#phong","children":[]},{"level":3,"title":"Blinn","slug":"blinn","link":"#blinn","children":[]}]},{"level":2,"title":"环境光","slug":"环境光","link":"#环境光","children":[]},{"level":2,"title":"Blinn Phong 展示","slug":"blinn-phong-展示","link":"#blinn-phong-展示","children":[]},{"level":2,"title":"逐像素还是逐顶点","slug":"逐像素还是逐顶点","link":"#逐像素还是逐顶点","children":[{"level":3,"title":"平面着色","slug":"平面着色","link":"#平面着色","children":[]},{"level":3,"title":"Phong着色","slug":"phong着色","link":"#phong着色","children":[]},{"level":3,"title":"高洛德着色","slug":"高洛德着色","link":"#高洛德着色","children":[]},{"level":3,"title":"对比","slug":"对比","link":"#对比","children":[]}]},{"level":2,"title":"简单实现","slug":"简单实现","link":"#简单实现","children":[]}],"git":{"createdTime":1614596035000,"updatedTime":1707214279000,"contributors":[{"name":"BanMing","email":"ban-ming@foxmail.com","commits":2},{"name":"wupeng","email":"wupeng_a2484@virtuos.com.cn","commits":2}]},"readingTime":{"minutes":10.54,"words":3161},"filePathRelative":"Graphic/basic/raster/shading.md","localizedDate":"March 1, 2021","excerpt":"\\n<p>我们在前面已经把图像三角形化了，明白了三角形的绘制规则，这样我们可以把一个物体画出来了，如下图：</p>\\n\\n<p>我们看到这个图是感受不出来是一个3d的模型，就是看起来很不真实，我们可以认出这个是个牛的模型，但是不知道这个是什么牛。</p>\\n<p>我们现实世界中看一个物体认为他是三维物体，是因为光照的关系，让物体表面有了明暗的差别，让我们知道是什么牛是因为物体表面的质感，也就是材质。</p>\\n<p>如果我们要在电脑上实现明暗的差别，简单的说就是为我们的渲染世界加一个灯，然后我们根据灯的一些属性（位置，方向，强度，颜色等）接合我们模型的颜色和位置，就可以产生明暗差别的效果（高光，漫反射，环境光）。如下图：</p>"}');export{U as comp,P as data};
